<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTO Vehicle Registration Form</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .section-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .section-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .section-number {
            background: #007bff;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 14px;
            font-weight: bold;
        }
        .section-number.completed {
            background: #28a745;
        }
        .section-body {
            padding: 20px;
        }
        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 5px;
        }
        .required {
            color: #dc3545;
        }
        .progress-container {
            position: sticky;
            top: 0;
            z-index: 1020;
            background: white;
            padding: 15px 0;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        .captcha-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            margin: 15px 0;
        }
        .submit-section {
            text-align: center;
            padding: 30px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Toast -->
    <div class="toast-container">
        <div class="toast align-items-center text-white bg-success border-0" id="successToast" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-check-circle me-2"></i>
                    Application submitted successfully!
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="container">
            <h4 class="text-center mb-3">RTO Vehicle Registration Form</h4>
            <div class="progress" style="height: 8px;">
                <div class="progress-bar bg-success" id="progressBar" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <div class="form-container">
        <form id="registrationForm" novalidate>
            <!-- Section 1: Owner Information -->
            <div class="section-card">
                <div class="section-header">
                    <span class="section-number" id="section1-number">1</span>
                    Owner Information
                </div>
                <div class="section-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="fullName" class="form-label">Full Name <span class="required">*</span></label>
                            <input type="text" class="form-control" id="fullName" placeholder="e.g. Priya Natarajan" required>
                            <div class="invalid-feedback">Please enter your full name.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email <span class="required">*</span></label>
                            <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
                            <div class="invalid-feedback">Please enter a valid email.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="mobile" class="form-label">Mobile (India) <span class="required">*</span></label>
                            <input type="tel" class="form-control" id="mobile" placeholder="+91 98XXXXXXX" required>
                            <div class="invalid-feedback">Please enter a valid mobile number.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="dob" class="form-label">Date of Birth <span class="required">*</span></label>
                            <input type="date" class="form-control" id="dob" required>
                            <div class="invalid-feedback">You must be at least 18 years old.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="pan" class="form-label">PAN <span class="required">*</span></label>
                            <input type="text" class="form-control" id="pan" placeholder="ABCDE1234F" required>
                            <div class="invalid-feedback">Please enter a valid PAN.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="dlNumber" class="form-label">Driving License No.</label>
                            <input type="text" class="form-control" id="dlNumber" placeholder="Format: State(2) + RTO(2) + 11 digits">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Address -->
            <div class="section-card">
                <div class="section-header">
                    <span class="section-number" id="section2-number">2</span>
                    Address
                </div>
                <div class="section-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="addressLine1" class="form-label">Address Line 1 <span class="required">*</span></label>
                            <input type="text" class="form-control" id="addressLine1" placeholder="e.g. TN10 AB 1234" required>
                            <div class="invalid-feedback">Please enter your address.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="vehicleClass" class="form-label">Vehicle Class <span class="required">*</span></label>
                            <select class="form-select" id="vehicleClass" required>
                                <option value="">Choose...</option>
                                <option value="2wheeler">Two Wheeler</option>
                                <option value="4wheeler">Four Wheeler</option>
                                <option value="commercial">Commercial</option>
                            </select>
                            <div class="invalid-feedback">Please select vehicle class.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="fuelType" class="form-label">Fuel Type <span class="required">*</span></label>
                            <select class="form-select" id="fuelType" required>
                                <option value="">Choose...</option>
                                <option value="petrol">Petrol</option>
                                <option value="diesel">Diesel</option>
                                <option value="cng">CNG</option>
                                <option value="electric">Electric</option>
                            </select>
                            <div class="invalid-feedback">Please select fuel type.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="make" class="form-label">Make <span class="required">*</span></label>
                            <input type="text" class="form-control" id="make" placeholder="e.g. Maruti Suzuki" required>
                            <div class="invalid-feedback">Please enter vehicle make.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="engineNo" class="form-label">Engine No. <span class="required">*</span></label>
                            <input type="text" class="form-control" id="engineNo" placeholder="Alphanumeric, 6-12" required>
                            <div class="invalid-feedback">Please enter engine number.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="yearOfManufacture" class="form-label">Year of Manufacture <span class="required">*</span></label>
                            <input type="number" class="form-control" id="yearOfManufacture" placeholder="2024" min="1990" max="2024" required>
                            <div class="invalid-feedback">Please enter a valid year.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="purchaseDate" class="form-label">Purchase Date <span class="required">*</span></label>
                            <input type="date" class="form-control" id="purchaseDate" required>
                            <div class="invalid-feedback">Please select purchase date.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Compliance & Insurance -->
            <div class="section-card">
                <div class="section-header">
                    <span class="section-number" id="section3-number">3</span>
                    Compliance & Insurance
                </div>
                <div class="section-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="emissionNorm" class="form-label">Emission Norm <span class="required">*</span></label>
                            <select class="form-select" id="emissionNorm" required>
                                <option value="">Choose...</option>
                                <option value="BS-III">BS-III</option>
                                <option value="BS-IV">BS-IV</option>
                                <option value="BS-VI">BS-VI</option>
                            </select>
                            <div class="invalid-feedback">Please select emission norm.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="insurancePolicyNo" class="form-label">Insurance Policy No. <span class="required">*</span></label>
                            <input type="text" class="form-control" id="insurancePolicyNo" placeholder="e.g. ICICI-ABCO1234" required>
                            <div class="invalid-feedback">Please enter policy number.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="insurer" class="form-label">Insurer <span class="required">*</span></label>
                            <input type="text" class="form-control" id="insurer" placeholder="e.g. New India Assurance" required>
                            <div class="invalid-feedback">Please enter insurer name.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="insuranceExpiry" class="form-label">Insurance Expiry <span class="required">*</span></label>
                            <input type="date" class="form-control" id="insuranceExpiry" required>
                            <div class="invalid-feedback">Insurance must be valid.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 5: Finance -->
            <div class="section-card">
                <div class="section-header">
                    <span class="section-number" id="section5-number">5</span>
                    Finance (Hypothecation)
                </div>
                <div class="section-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="isHypothecated">
                        <label class="form-check-label" for="isHypothecated">
                            Vehicle is under hypothecation / loan
                        </label>
                    </div>
                </div>
            </div>

            <!-- Section 6: Uploads -->
            <div class="section-card">
                <div class="section-header">
                    <span class="section-number" id="section6-number">6</span>
                    Uploads
                </div>
                <div class="section-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="idProof" class="form-label">ID/Address Proof <span class="required">*</span></label>
                            <input type="file" class="form-control" id="idProof" accept=".pdf,.jpg,.jpeg,.png" required>
                            <small class="text-muted">PDF, JPG, PNG (Max 2 MB)</small>
                            <div class="invalid-feedback">Please upload ID proof.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="insuranceCopy" class="form-label">Insurance Copy <span class="required">*</span></label>
                            <input type="file" class="form-control" id="insuranceCopy" accept=".pdf,.jpg,.jpeg,.png" required>
                            <small class="text-muted">PDF, JPG, PNG (Max 2 MB)</small>
                            <div class="invalid-feedback">Please upload insurance copy.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="vehicleImage" class="form-label">Vehicle Image (Optional)</label>
                            <input type="file" class="form-control" id="vehicleImage" accept=".jpg,.jpeg,.png">
                            <small class="text-muted">JPG, PNG (Max 2 MB)</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CAPTCHA and Submit -->
            <div class="captcha-box">
                <div class="mb-2">
                    <strong id="captchaQuestion">What is 5 + 3?</strong>
                </div>
                <div class="d-flex justify-content-center align-items-center gap-2">
                    <input type="number" class="form-control" id="captchaAnswer" style="width: 80px;" required>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="refreshCaptcha">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
                <div class="invalid-feedback">Please solve the math problem.</div>
            </div>

            <div class="form-check mb-4">
                <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                <label class="form-check-label" for="agreeTerms">
                    I agree to the <a href="#" class="text-decoration-none">Terms and Conditions</a> <span class="required">*</span>
                </label>
                <div class="invalid-feedback">You must agree to terms.</div>
            </div>

            <div class="submit-section">
                <button type="submit" class="btn btn-primary btn-lg px-4" id="submitBtn" disabled>
                    <i class="fas fa-paper-plane me-2"></i>
                    Submit Application
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const form = document.getElementById('registrationForm');
        const progressBar = document.getElementById('progressBar');
        const submitBtn = document.getElementById('submitBtn');
        let captchaAnswer = 8;

        // Section validation
        const sections = {
            section1: false,
            section2: false,
            section3: false,
            section5: true, // Optional
            section6: false
        };

        document.addEventListener('DOMContentLoaded', function() {
            setupValidation();
            generateCaptcha();
            updateProgress();
        });

        function setupValidation() {
            // Form field validation
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('input', validateField);
                input.addEventListener('change', validateField);
            });

            // File validation
            form.querySelectorAll('input[type="file"]').forEach(input => {
                input.addEventListener('change', validateFile);
            });

            // Terms and CAPTCHA
            document.getElementById('agreeTerms').addEventListener('change', updateSubmitButton);
            document.getElementById('captchaAnswer').addEventListener('input', validateCaptcha);
            document.getElementById('refreshCaptcha').addEventListener('click', generateCaptcha);

            // Form submission
            form.addEventListener('submit', handleSubmit);
        }

        function validateField(event) {
            const field = event.target;
            let isValid = true;

            field.classList.remove('is-valid', 'is-invalid');

            if (field.required && !field.value.trim()) {
                isValid = false;
            } else if (field.value.trim()) {
                // Custom validations
                switch (field.id) {
                    case 'email':
                        isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(field.value);
                        break;
                    case 'mobile':
                        isValid = /^(\+91|91)?[6-9]\d{9}$/.test(field.value.replace(/\s/g, ''));
                        break;
                    case 'dob':
                        const age = new Date().getFullYear() - new Date(field.value).getFullYear();
                        isValid = age >= 18;
                        break;
                    case 'pan':
                        isValid = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(field.value.toUpperCase());
                        break;
                    case 'purchaseDate':
                        isValid = new Date(field.value) <= new Date();
                        break;
                    case 'insuranceExpiry':
                        isValid = new Date(field.value) >= new Date();
                        break;
                }
            }

            field.classList.add(isValid ? 'is-valid' : 'is-invalid');
            validateSection(getSectionForField(field.id));
            return isValid;
        }

        function validateFile(event) {
            const file = event.target.files[0];
            const field = event.target;
            let isValid = true;

            field.classList.remove('is-valid', 'is-invalid');

            if (field.required && !file) {
                isValid = false;
            } else if (file) {
                // Check file size (2MB)
                if (file.size > 2 * 1024 * 1024) {
                    isValid = false;
                    field.setCustomValidity('File size must be less than 2MB');
                } else {
                    field.setCustomValidity('');
                }
            }

            field.classList.add(isValid ? 'is-valid' : 'is-invalid');
            validateSection(getSectionForField(field.id));
        }

        function getSectionForField(fieldId) {
            if (['fullName', 'email', 'mobile', 'dob', 'pan', 'dlNumber'].includes(fieldId)) return 'section1';
            if (['addressLine1', 'vehicleClass', 'fuelType', 'make', 'engineNo', 'yearOfManufacture', 'purchaseDate'].includes(fieldId)) return 'section2';
            if (['emissionNorm', 'insurancePolicyNo', 'insurer', 'insuranceExpiry'].includes(fieldId)) return 'section3';
            if (['idProof', 'insuranceCopy', 'vehicleImage'].includes(fieldId)) return 'section6';
            return 'section5';
        }

        function validateSection(sectionId) {
            const sectionFields = getSectionFields(sectionId);
            const isValid = sectionFields.every(field => {
                return !field.required || (field.classList.contains('is-valid') && field.value.trim());
            });

            sections[sectionId] = isValid;
            const numberElement = document.getElementById(`${sectionId}-number`);
            numberElement.classList.toggle('completed', isValid);
            
            updateProgress();
            updateSubmitButton();
        }

        function getSectionFields(sectionId) {
            const fieldGroups = {
                section1: ['fullName', 'email', 'mobile', 'dob', 'pan'],
                section2: ['addressLine1', 'vehicleClass', 'fuelType', 'make', 'engineNo', 'yearOfManufacture', 'purchaseDate'],
                section3: ['emissionNorm', 'insurancePolicyNo', 'insurer', 'insuranceExpiry'],
                section6: ['idProof', 'insuranceCopy']
            };
            return (fieldGroups[sectionId] || []).map(id => document.getElementById(id)).filter(el => el);
        }

        function updateProgress() {
            const completedSections = Object.values(sections).filter(Boolean).length;
            const progress = (completedSections / Object.keys(sections).length) * 100;
            progressBar.style.width = progress + '%';
        }

        function generateCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            captchaAnswer = num1 + num2;
            document.getElementById('captchaQuestion').textContent = `What is ${num1} + ${num2}?`;
            document.getElementById('captchaAnswer').value = '';
        }

        function validateCaptcha() {
            const userAnswer = parseInt(document.getElementById('captchaAnswer').value);
            const isValid = userAnswer === captchaAnswer;
            const field = document.getElementById('captchaAnswer');
            
            field.classList.remove('is-valid', 'is-invalid');
            if (field.value) {
                field.classList.add(isValid ? 'is-valid' : 'is-invalid');
            }
            
            updateSubmitButton();
            return isValid;
        }

        function updateSubmitButton() {
            const allSectionsValid = Object.values(sections).every(Boolean);
            const termsChecked = document.getElementById('agreeTerms').checked;
            const captchaValid = validateCaptcha();
            
            submitBtn.disabled = !(allSectionsValid && termsChecked && captchaValid);
        }

        function handleSubmit(event) {
            event.preventDefault();
            
            if (!form.checkValidity()) {
                event.stopPropagation();
                form.classList.add('was-validated');
                return;
            }

            // Show success toast
            const toast = new bootstrap.Toast(document.getElementById('successToast'));
            toast.show();
            
            // Reset form
            setTimeout(() => {
                form.reset();
                form.classList.remove('was-validated');
                Object.keys(sections).forEach(key => sections[key] = key === 'section5');
                updateProgress();
                generateCaptcha();
                document.querySelectorAll('.section-number').forEach(el => el.classList.remove('completed'));
            }, 2000);
        }
    </script>
</body>
</html>